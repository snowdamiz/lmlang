<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>lmlang Unified Dashboard</title>
    <link rel="stylesheet" href="/dashboard/styles.css" />
  </head>
  <body data-initial-program-id="__INITIAL_PROGRAM_ID__">
    <div class="page-shell">
      <header class="topbar">
        <div>
          <p class="eyebrow">lmlang Control Center</p>
          <h1>Unified Dashboard</h1>
          <p class="subtitle">AI-first control loop: use the chat box to create projects, configure agents, build, run, and query.</p>
        </div>
        <div class="badge-row">
          <span class="badge" id="activeProjectBadge">Project: none</span>
          <span class="badge" id="activeAgentBadge">Agent: none</span>
          <span class="badge" id="runStatusBadge">Run: idle</span>
        </div>
      </header>

      <main class="workspace">
        <section class="panel" aria-label="Projects">
          <h2>Projects</h2>
          <p class="hint">Create a project, then select it to manage assigned agents.</p>
          <div class="controls">
            <input id="projectNameInput" placeholder="new-project-name" />
            <button id="createProjectBtn" type="button">Create Project</button>
            <button id="refreshProjectsBtn" type="button">Refresh</button>
          </div>
          <ul id="projectList" class="list"></ul>
          <div class="controls">
            <button id="createHelloWorldBtn" type="button">Create Hello World Scaffold</button>
          </div>
          <p class="hint">
            Seeds a first `hello_world` function and verifies it so you can immediately visualize/query in Observe.
          </p>
          <a id="observeLink" class="inline-link" href="#" target="_blank" rel="noopener noreferrer">Open selected project in Observe</a>
        </section>

        <section class="panel" aria-label="Agents">
          <h2>Agents</h2>
          <p class="hint">Register global agents, configure AI provider access, then assign one to the selected project.</p>
          <div class="controls">
            <input id="agentNameInput" placeholder="optional agent name" />
            <button id="registerAgentBtn" type="button">Register Agent</button>
            <button id="refreshAgentsBtn" type="button">Refresh</button>
          </div>
          <div class="controls">
            <select id="agentProviderSelect">
              <option value="">No external provider</option>
              <option value="openrouter">OpenRouter</option>
              <option value="openai_compatible">OpenAI-compatible</option>
            </select>
            <input id="agentModelInput" placeholder="model (e.g. openai/gpt-4o-mini)" />
          </div>
          <div class="controls">
            <input id="agentBaseUrlInput" placeholder="api base url (optional for OpenRouter)" />
            <input id="agentApiKeyInput" type="password" placeholder="api key (stored in-memory)" />
          </div>
          <div class="controls">
            <input id="agentSystemPromptInput" placeholder="system prompt (optional)" />
            <button id="saveAgentConfigBtn" type="button">Save Agent Config</button>
          </div>
          <div class="controls">
            <select id="agentAssignSelect"></select>
            <button id="assignAgentBtn" type="button">Assign To Project</button>
          </div>
          <h3>Assigned To Project</h3>
          <ul id="projectAgentList" class="list"></ul>
        </section>

        <section class="panel panel-chat" aria-label="Build and Chat">
          <h2>Build Control + Chat</h2>
          <p class="hint">Primary interface: ask chat to do everything (create project, register/configure/assign agent, start/stop build, create/compile/run).</p>
          <div class="controls">
            <input id="goalInput" placeholder="build goal" />
            <button id="startBuildBtn" type="button">Start Build</button>
            <button id="stopBuildBtn" type="button">Stop Build</button>
          </div>
          <div class="chat-log" id="chatLog"></div>
          <div class="controls">
            <input id="chatInput" placeholder="message to agent" />
            <button id="sendChatBtn" type="button">Send</button>
          </div>
        </section>
      </main>

      <footer class="statusbar" id="statusBar" data-state="idle">Dashboard ready.</footer>
    </div>

    <div class="setup-overlay hidden" id="setupWizard" role="dialog" aria-modal="true" aria-label="First-time setup">
      <section class="setup-card">
        <h2>First-Time AI Setup</h2>
        <p class="hint">
          Configure your provider once so agents can use real AI replies from the dashboard.
        </p>
        <div class="controls">
          <input id="setupAgentNameInput" placeholder="agent name (optional)" />
          <select id="setupProviderSelect">
            <option value="openrouter">OpenRouter</option>
            <option value="openai_compatible">OpenAI-compatible</option>
          </select>
        </div>
        <div class="controls">
          <input id="setupModelInput" placeholder="model (e.g. openai/gpt-4o-mini)" />
          <input id="setupApiKeyInput" type="password" placeholder="api key" />
        </div>
        <div class="controls">
          <input id="setupBaseUrlInput" placeholder="base url (optional for OpenRouter)" />
        </div>
        <div class="controls">
          <button id="setupCompleteBtn" type="button">Complete Setup</button>
          <button id="setupSkipBtn" type="button">Skip For Now</button>
        </div>
      </section>
    </div>

    <script src="/dashboard/app.js" defer></script>
  </body>
</html>
