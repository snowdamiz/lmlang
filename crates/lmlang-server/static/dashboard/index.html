<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>lmlang Dashboard</title>
    <link rel="stylesheet" href="/dashboard/styles.css" />
  </head>
  <body data-initial-program-id="__INITIAL_PROGRAM_ID__">
    <div class="shell">
      <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
          <div class="logo">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <rect width="24" height="24" rx="6" fill="currentColor" fill-opacity="0.15"/>
              <path d="M7 8h10M7 12h6M7 16h8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            <span class="logo-text">lmlang</span>
          </div>
          <button class="sidebar-toggle" id="sidebarToggle" type="button" aria-label="Toggle sidebar">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M10 3L5 8l5 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
          </button>
        </div>

        <div class="sidebar-body">
          <!-- ── Projects ── -->
          <section class="sidebar-section">
            <div class="section-header">
              <h3 class="section-label">Projects</h3>
              <button id="refreshProjectsBtn" type="button" class="section-action-btn" title="Refresh projects">
                <svg width="13" height="13" viewBox="0 0 16 16" fill="none"><path d="M14 8A6 6 0 1 1 8 2" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/><path d="M8 1l3 1.5L8 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
              </button>
            </div>
            <div class="field-row">
              <input id="projectNameInput" placeholder="New project name..." />
              <button id="createProjectBtn" type="button" class="btn btn-sm">Create</button>
            </div>
            <ul id="projectList" class="entity-list"></ul>
            <details class="collapsible">
              <summary>Project tools</summary>
              <div class="collapsible-body">
                <button id="createHelloWorldBtn" type="button" class="btn btn-block btn-ghost-sidebar">Scaffold Hello World</button>
                <a id="observeLink" class="btn-link" href="#" target="_blank" rel="noopener noreferrer">Open in Observe</a>
              </div>
            </details>
          </section>

          <div class="sidebar-divider"></div>

          <!-- ── Agents ── -->
          <section class="sidebar-section">
            <div class="section-header">
              <h3 class="section-label">Agents</h3>
              <button id="refreshAgentsBtn" type="button" class="section-action-btn" title="Refresh agents">
                <svg width="13" height="13" viewBox="0 0 16 16" fill="none"><path d="M14 8A6 6 0 1 1 8 2" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/><path d="M8 1l3 1.5L8 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
              </button>
            </div>

            <!-- Registered agent list (click to select, x to delete) -->
            <ul id="agentList" class="entity-list"></ul>

            <div class="field-row">
              <input id="agentNameInput" placeholder="New agent name..." />
              <button id="registerAgentBtn" type="button" class="btn btn-sm">Add</button>
            </div>

            <details class="collapsible">
              <summary>Provider config</summary>
              <div class="collapsible-body">
                <select id="agentProviderSelect">
                  <option value="">No external provider</option>
                  <option value="openrouter">OpenRouter</option>
                  <option value="openai_compatible">OpenAI-compatible</option>
                </select>
                <input id="agentModelInput" placeholder="Model (e.g. openai/gpt-4o-mini)" />
                <input id="agentBaseUrlInput" placeholder="API base URL (optional)" />
                <input id="agentApiKeyInput" type="password" placeholder="API key" />
                <input id="agentSystemPromptInput" placeholder="System prompt (optional)" />
                <button id="saveAgentConfigBtn" type="button" class="btn btn-block">Save Config</button>
              </div>
            </details>

            <div class="sidebar-divider"></div>

            <h4 class="section-sublabel">Assigned to Project</h4>
            <ul id="projectAgentList" class="entity-list entity-list-compact"></ul>
          </section>
        </div>
      </aside>

      <main class="content">
        <header class="topbar">
          <div class="topbar-left">
            <button class="sidebar-open-btn" id="sidebarOpenBtn" type="button" aria-label="Open sidebar">
              <svg width="18" height="18" viewBox="0 0 18 18" fill="none"><path d="M3 5h12M3 9h12M3 13h12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
            </button>
            <h1 class="page-title">Dashboard</h1>
          </div>
          <div class="status-indicators">
            <span class="indicator" id="activeProjectBadge">
              <span class="indicator-dot idle"></span>
              Project: none
            </span>
            <span class="indicator" id="activeAgentBadge">Agent: none</span>
            <span class="indicator" id="runStatusBadge">Run: idle</span>
            <span class="indicator" id="apiKeyStatusBadge">
              <span class="indicator-dot disconnected" aria-hidden="true"></span>
              <span class="badge-label">OpenRouter: disconnected</span>
            </span>
          </div>
        </header>

        <div class="chat-container">
          <div class="chat-toolbar">
            <input id="goalInput" class="goal-input" placeholder="Build goal (e.g. add login and tests)..." />
            <button id="startBuildBtn" type="button" class="btn btn-primary">
              <svg width="14" height="14" viewBox="0 0 14 14" fill="none"><path d="M3 1.5l9 5.5-9 5.5V1.5z" fill="currentColor"/></svg>
              Build
            </button>
            <button id="stopBuildBtn" type="button" class="btn btn-danger">
              <svg width="14" height="14" viewBox="0 0 14 14" fill="none"><rect x="2" y="2" width="10" height="10" rx="1.5" fill="currentColor"/></svg>
              Stop
            </button>
          </div>

          <div class="chat-log" id="chatLog"></div>

          <div class="chat-input-area">
            <input id="chatInput" class="chat-input" placeholder="Message the agent..." />
            <button id="sendChatBtn" type="button" class="btn btn-primary btn-send">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M2 2l12 6-12 6V9l8-1-8-1V2z" fill="currentColor"/></svg>
            </button>
          </div>
        </div>

        <footer class="statusbar" id="statusBar" data-state="idle">Dashboard ready.</footer>
      </main>
    </div>

    <div class="modal-overlay hidden" id="setupWizard" role="dialog" aria-modal="true" aria-label="First-time setup">
      <div class="modal-backdrop"></div>
      <section class="modal-card">
        <div class="modal-header">
          <h2>AI Provider Setup</h2>
          <p class="modal-subtitle">Configure an AI provider so agents can generate real responses.</p>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label for="setupAgentNameInput">Agent name</label>
            <input id="setupAgentNameInput" placeholder="e.g. builder" />
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="setupProviderSelect">Provider</label>
              <select id="setupProviderSelect">
                <option value="openrouter">OpenRouter</option>
                <option value="openai_compatible">OpenAI-compatible</option>
              </select>
            </div>
            <div class="form-group">
              <label for="setupModelInput">Model</label>
              <input id="setupModelInput" placeholder="openai/gpt-4o-mini" />
            </div>
          </div>
          <div class="form-group">
            <label for="setupApiKeyInput">API Key</label>
            <input id="setupApiKeyInput" type="password" placeholder="sk-..." />
          </div>
          <div class="form-group">
            <label for="setupBaseUrlInput">Base URL <span class="label-hint">(optional for OpenRouter)</span></label>
            <input id="setupBaseUrlInput" placeholder="https://openrouter.ai/api/v1" />
          </div>
        </div>
        <div class="modal-footer">
          <button id="setupSkipBtn" type="button" class="btn btn-ghost">Skip</button>
          <button id="setupCompleteBtn" type="button" class="btn btn-primary">Complete Setup</button>
        </div>
      </section>
    </div>

    <script src="/dashboard/app.js" defer></script>
  </body>
</html>
