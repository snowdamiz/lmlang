<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>lmlang Dashboard</title>
    <link rel="stylesheet" href="/programs/__PROGRAM_ID__/dashboard/styles.css" />
  </head>
  <body data-program-id="__PROGRAM_ID__">
    <div class="dashboard-shell">
      <header class="dashboard-header">
        <div class="brand-block">
          <p class="eyebrow">Program Dashboard</p>
          <h1>Operate + Observe</h1>
          <p class="subtitle">
            Endpoint-first orchestration controls paired with the existing observability surface.
          </p>
        </div>
        <div class="badge-row">
          <span class="badge" id="programBadge">Program __PROGRAM_ID__</span>
          <span class="badge" id="agentBadge">No agent selected</span>
          <span class="badge" id="statusBadge">Status: idle</span>
          <span class="badge" id="templateBadge">Template: execute-phase</span>
        </div>
      </header>

      <section class="context-strip" aria-label="Run context overview">
        <div>
          <p class="strip-label">Program Context</p>
          <p class="strip-value">Program ID <strong id="contextProgramId">__PROGRAM_ID__</strong></p>
        </div>
        <div>
          <p class="strip-label">Workflow Mode</p>
          <p class="strip-value">Endpoint-first Operate using existing API contracts</p>
        </div>
        <div>
          <p class="strip-label">Observe Reuse</p>
          <p class="strip-value">Mounted from <code>/programs/__PROGRAM_ID__/observability</code></p>
        </div>
      </section>

      <nav class="tab-nav" aria-label="Dashboard modules">
        <button class="tab-btn is-active" data-tab="operate" type="button">Operate</button>
        <button class="tab-btn" data-tab="observe" type="button">Observe</button>
      </nav>

      <main class="tab-panels">
        <section class="panel is-active" id="operatePanel" data-panel="operate" aria-label="Operate panel">
          <div class="operate-columns">
            <article class="panel-card" id="agentListContainer">
              <header>
                <h2>Agents & Session State</h2>
                <p class="card-intro">
                  Registered agents with derived state labels: idle, running, blocked, error.
                </p>
              </header>
              <div id="operateAgentListMount" class="content-mount"></div>
            </article>

            <article class="panel-card" id="runSetupContainer">
              <header>
                <h2>Run Setup</h2>
                <p class="card-intro">
                  Configure workflow template and task prompt before launching actions.
                </p>
              </header>
              <div id="operateRunSetupMount" class="content-mount"></div>
            </article>

            <article class="panel-card" id="actionsContainer">
              <header>
                <h2>Actions</h2>
                <p class="card-intro">
                  Register/list/deregister agents, locks, mutations, verify, simulate, compile, and history.
                </p>
              </header>
              <div id="operateActionsMount" class="content-mount"></div>
            </article>

            <article class="panel-card" id="timelineContainer">
              <header>
                <h2>Timeline / History Preview</h2>
                <p class="card-intro">
                  Operation timeline and history snapshots for rapid diagnostics.
                </p>
              </header>
              <div id="operateTimelineMount" class="content-mount"></div>
            </article>

            <article class="panel-card" id="outputContainer">
              <header>
                <h2>Request / Response Output</h2>
                <p class="card-intro">
                  Structured payload snapshots for endpoint actions and troubleshooting.
                </p>
              </header>
              <div id="operateOutputMount" class="content-mount"></div>
            </article>
          </div>
          <section class="operate-footer-notes" aria-label="Operate notes">
            <h3>Operate Notes</h3>
            <p>
              Actions in this tab intentionally target existing APIs first. Missing lifecycle/timeline controls are deferred to later phases.
            </p>
            <p>
              Use the shared status bar for immediate feedback, then inspect request/response snapshots and the timeline panel for details.
            </p>
          </section>
        </section>

        <section class="panel" id="observePanel" data-panel="observe" aria-label="Observe panel">
          <div class="observe-toolbar">
            <p>
              Observe reuses the existing observability UI and backend graph/query endpoints.
            </p>
            <a id="openObserveLink" href="/programs/__PROGRAM_ID__/observability" target="_blank" rel="noopener noreferrer">
              Open Observe in a new tab
            </a>
          </div>
          <div id="observeMount" class="observe-mount" data-observe-src="/programs/__PROGRAM_ID__/observability"></div>
        </section>
      </main>

      <aside id="sharedStatusPanel" class="shared-status" aria-live="polite" aria-label="Shared status">
        Dashboard shell initialized.
      </aside>
    </div>

    <script src="/programs/__PROGRAM_ID__/dashboard/app.js" defer></script>
  </body>
</html>
