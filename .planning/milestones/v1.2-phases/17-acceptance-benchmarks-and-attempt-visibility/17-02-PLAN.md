---
phase: 17-acceptance-benchmarks-and-attempt-visibility
plan: 02
type: execute
wave: 2
depends_on:
  - "17-01"
files_modified:
  - crates/lmlang-server/src/autonomy_executor.rs
  - crates/lmlang-server/src/autonomous_runner.rs
  - crates/lmlang-server/tests/integration_test.rs
autonomous: true
requirements:
  - AUT-09
  - AUT-10
  - AUT-11

must_haves:
  truths:
    - "Prompt `Create a simple calculator` exercises the real planner/executor autonomy path and records attempt evidence containing calculator-oriented structure markers"
    - "At least two additional non-trivial benchmark prompts run through the same generic pipeline with persisted attempt records"
    - "Benchmark assertions verify verify/compile attempt visibility and terminal outcomes without provider nondeterminism"
    - "Action evidence summaries are rich enough to distinguish benchmark intent outcomes (not just generic mutation counts)"
  artifacts:
    - path: "crates/lmlang-server/tests/integration_test.rs"
      provides: "Deterministic `phase17_*` benchmark acceptance scenarios for calculator plus two additional prompts"
      contains: "phase17_"
    - path: "crates/lmlang-server/src/autonomy_executor.rs"
      provides: "Action evidence summarization that exposes benchmark-relevant structure markers"
      contains: "mutate_batch"
    - path: "crates/lmlang-server/src/autonomous_runner.rs"
      provides: "Attempt persistence/notes remain deterministic while benchmark flows execute through the generic retry loop"
      contains: "Execution attempt"
  key_links:
    - from: "crates/lmlang-server/tests/integration_test.rs"
      to: "crates/lmlang-server/src/autonomous_runner.rs"
      via: "Integration scenarios drive real autonomous start/wait flow and assert persisted attempt outcomes"
      pattern: "/start|wait_for_run_status|execution"
    - from: "crates/lmlang-server/tests/integration_test.rs"
      to: "crates/lmlang-server/src/autonomy_executor.rs"
      via: "Benchmark assertions validate executor action evidence summaries for calculator/string/state-machine structure markers"
      pattern: "actions|summary|mutate_batch|compile|verify"
    - from: "crates/lmlang-server/src/autonomous_runner.rs"
      to: "crates/lmlang-server/src/autonomy_executor.rs"
      via: "Runner persists executor-produced action evidence into attempt records consumed by benchmark checks"
      pattern: "execute_plan|append_execution_attempt|action_results"
---

<objective>
Implement deterministic benchmark acceptance coverage for AUT-10 and AUT-11.

Purpose: Prove the user-facing autonomous capability on calculator and two additional benchmark prompts using the same generic planner/executor path.
Output: Benchmark-safe action evidence and deterministic phase17 integration tests with persisted attempt assertions.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@.planning/STATE.md
@.planning/phases/17-acceptance-benchmarks-and-attempt-visibility/17-RESEARCH.md
@.planning/phases/17-acceptance-benchmarks-and-attempt-visibility/17-01-PLAN.md
@crates/lmlang-server/src/autonomous_runner.rs
@crates/lmlang-server/src/autonomy_executor.rs
@crates/lmlang-server/tests/integration_test.rs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Strengthen action evidence summaries for benchmark-level structure assertions</name>
  <files>
    crates/lmlang-server/src/autonomy_executor.rs
    crates/lmlang-server/src/autonomous_runner.rs
  </files>
  <action>
    Refine autonomous action evidence so benchmark acceptance checks can assert meaningful structure outcomes:
    - expose concise mutation target hints (for example function/entity names where available),
    - preserve verify/compile attempt evidence in consistent summary/detail fields,
    - keep retry-loop semantics unchanged.

    Ensure these summaries remain deterministic and safe for operator display.
  </action>
  <verify>
    Focused tests/assertions confirm benchmark-relevant action summaries are emitted consistently for mutate/verify/compile steps.
  </verify>
  <done>
    Attempt records carry enough semantic detail to verify calculator/string/state-machine benchmark intent outcomes.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add deterministic phase17 benchmark scenarios (calculator + two additional prompts)</name>
  <files>
    crates/lmlang-server/tests/integration_test.rs
  </files>
  <action>
    Add `phase17_*` integration coverage using deterministic mock planner responses for:
    - calculator prompt (`Create a simple calculator`)
    - string utility prompt
    - state-machine/workflow prompt

    For each scenario, assert:
    - autonomous run uses planner/executor path,
    - attempt records persist in session execution metadata,
    - action evidence includes benchmark-appropriate structure markers,
    - verify/compile attempt evidence and terminal status are visible.
  </action>
  <verify>
    `cargo test --package lmlang-server --test integration_test phase17_` passes with stable deterministic assertions.
  </verify>
  <done>
    AUT-10 and AUT-11 are acceptance-tested through the same generic autonomy pipeline.
  </done>
</task>

</tasks>

<verification>
1. `phase17_*` integration tests exist for calculator + two additional non-trivial benchmark prompts
2. Calculator benchmark asserts real autonomous attempt plus verify/compile attempt visibility
3. Additional benchmarks assert same planner/executor path and persisted attempt records
4. Action evidence contains benchmark-relevant structure markers (not only generic counts)
5. Phase16 regression behavior remains intact alongside new benchmark coverage
</verification>

<success_criteria>
- AUT-10 satisfied with deterministic acceptance evidence for calculator prompt behavior
- AUT-11 satisfied with deterministic acceptance evidence for two additional benchmark prompts
- AUT-09 evidence quality improved through benchmark-usable attempt/action summaries
</success_criteria>

<output>
After completion, create `.planning/phases/17-acceptance-benchmarks-and-attempt-visibility/17-02-SUMMARY.md`
</output>
