---
phase: 15-generic-graph-build-executor
plan: 03
type: execute
wave: 3
depends_on:
  - "15-01"
  - "15-02"
files_modified:
  - crates/lmlang-server/tests/integration_test.rs
  - crates/lmlang-server/src/autonomy_executor.rs
  - docs/api/operator-endpoints.md
autonomous: true
requirements:
  - AUT-04
  - AUT-05
  - AUT-06

must_haves:
  truths:
    - "Phase 15 autonomous execution behavior is covered by deterministic integration tests with mock planner responses"
    - "Retry-budget and terminal stop-reason outcomes are asserted as contract-level API behavior"
    - "Operator documentation clearly describes executor behavior, stop reason codes, and evidence fields"
    - "Phase 14 planner routing and explicit command-path regressions remain protected"
  artifacts:
    - path: "crates/lmlang-server/tests/integration_test.rs"
      provides: "End-to-end phase15_* coverage for action execution success/failure, bounded retries, and stop-reason visibility"
      contains: "phase15"
    - path: "crates/lmlang-server/src/autonomy_executor.rs"
      provides: "Unit tests for action-dispatch failure normalization and terminal outcome classification"
      contains: "#[cfg(test)]"
    - path: "docs/api/operator-endpoints.md"
      provides: "Operator-facing contract examples for autonomous execution metadata and stop reason taxonomy"
      contains: "AUT-06"
  key_links:
    - from: "crates/lmlang-server/tests/integration_test.rs"
      to: "crates/lmlang-server/src/autonomous_runner.rs"
      via: "Integration tests validate bounded run-loop transitions and terminal stop reasons"
      pattern: "start|stop|planner|execution|stop_reason"
    - from: "crates/lmlang-server/tests/integration_test.rs"
      to: "crates/lmlang-server/src/autonomy_executor.rs"
      via: "Execution-path tests verify planner action dispatch produces expected action outcomes"
      pattern: "mutate_batch|verify|compile|simulate|history|inspect"
    - from: "docs/api/operator-endpoints.md"
      to: "crates/lmlang-server/src/schema/agent_control.rs"
      via: "Published API examples match structured execution metadata and terminal reason fields"
      pattern: "execution|stop_reason|attempt"
---

<objective>
Harden and document Phase 15 executor behavior with deterministic tests and contract docs.

Purpose: Lock AUT-04/AUT-05/AUT-06 behavior with regression coverage and operator-facing endpoint documentation.
Output: Phase15 integration tests plus updated endpoint docs for execution evidence and stop reasons.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@.planning/STATE.md
@.planning/phases/15-generic-graph-build-executor/15-RESEARCH.md
@.planning/phases/15-generic-graph-build-executor/15-01-PLAN.md
@.planning/phases/15-generic-graph-build-executor/15-02-PLAN.md
@crates/lmlang-server/tests/integration_test.rs
@crates/lmlang-server/src/autonomous_runner.rs
@crates/lmlang-server/src/autonomy_executor.rs
@crates/lmlang-server/src/handlers/agent_control.rs
@crates/lmlang-server/src/handlers/dashboard.rs
@crates/lmlang-server/src/schema/agent_control.rs
@crates/lmlang-server/src/schema/dashboard.rs
@docs/api/operator-endpoints.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add deterministic phase15 integration tests for executor loop behavior</name>
  <files>
    crates/lmlang-server/tests/integration_test.rs
  </files>
  <action>
    Add integration tests (phase15_* naming) that cover:
    - accepted planner plan with executable action sequence reaching successful terminal state
    - planner/action failure path that consumes retry budget and ends with explicit stop reason code
    - transcript/API evidence exposure for attempt/action summaries
    - regression guard that explicit command prompts still run deterministic hello-world path

    Reuse deterministic mock planner server pattern from Phase 14; avoid live provider dependencies.
  </action>
  <verify>
    `cargo test --package lmlang-server --test integration_test phase15_` passes and includes both success and retry-exhaustion stop-reason assertions.
  </verify>
  <done>
    Phase 15 behavior is locked with repeatable end-to-end coverage.
  </done>
</task>

<task type="auto">
  <name>Task 2: Finalize operator documentation for executor loop and stop reasons</name>
  <files>
    docs/api/operator-endpoints.md
    crates/lmlang-server/src/autonomy_executor.rs
  </files>
  <action>
    Update endpoint docs with:
    - bounded loop behavior (`plan -> apply -> verify -> replan`) overview
    - terminal stop reason code taxonomy with meanings
    - sample response payloads including execution metadata fields
    - brief troubleshooting guidance for common autonomous stop reasons

    Ensure documentation examples match serialized schema fields asserted by integration tests.
  </action>
  <verify>
    Docs and tests agree on response field names and stop reason code values for representative success/failure cases.
  </verify>
  <done>
    Operators can interpret autonomous run outcomes without reading server internals.
  </done>
</task>

</tasks>

<verification>
1. `phase15_*` integration tests exist and pass for both success and retry-exhausted outcomes
2. Tests assert machine-readable stop reason code visibility in API/transcript outputs
3. Planner-action execution assertions cover more than one action kind
4. Phase14 planner-routing and explicit command-path compatibility remain green
5. Operator endpoint docs include accurate execution metadata and stop-reason examples
</verification>

<success_criteria>
- AUT-04 behavior is test-backed at integration level (planner actions execute against graph primitives)
- AUT-05 loop behavior is test-backed (bounded retries and deterministic termination)
- AUT-06 visibility is test-backed and documented (stop reason + transcript evidence)
</success_criteria>

<output>
After completion, create `.planning/phases/15-generic-graph-build-executor/15-03-SUMMARY.md`
</output>
