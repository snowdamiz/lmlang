---
phase: 10-unified-dashboard-shell-endpoint-first-operate-tab
plan: 02
type: execute
wave: 2
depends_on:
  - "10-01"
files_modified:
  - crates/lmlang-server/static/dashboard/index.html
  - crates/lmlang-server/static/dashboard/app.js
  - crates/lmlang-server/static/dashboard/styles.css
  - crates/lmlang-server/tests/integration_test.rs
autonomous: true
requirements:
  - UI-01
  - UI-02

must_haves:
  truths:
    - "Operate tab lists registered agents and displays actionable status categories: idle, running, blocked, error"
    - "Operate run setup allows selecting target program, workflow template, and task prompt"
    - "Operate actions call existing endpoints only for agents, locks, mutations, verify, simulate, compile, and history"
    - "Lock and mutation actions correctly apply X-Agent-Id where required"
    - "Mutation flow supports dry-run preview and commit execution using existing mutations API"
  artifacts:
    - path: "crates/lmlang-server/static/dashboard/app.js"
      provides: "Operate API client, action orchestration, status derivation, and UI event wiring"
      min_lines: 320
    - path: "crates/lmlang-server/static/dashboard/index.html"
      provides: "Operate panels for agent/session list, run setup, actions, and response viewers"
      min_lines: 130
    - path: "crates/lmlang-server/static/dashboard/styles.css"
      provides: "Operate layout and status styling for idle/running/blocked/error states"
      min_lines: 180
    - path: "crates/lmlang-server/tests/integration_test.rs"
      provides: "Dashboard static contract checks for endpoint references and operate action affordances"
      contains: "dashboard"
  key_links:
    - from: "crates/lmlang-server/static/dashboard/app.js"
      to: "crates/lmlang-server/src/router.rs"
      via: "Operate actions target pre-existing API endpoints already exposed by router"
      pattern: "/agents|/programs/"
    - from: "crates/lmlang-server/static/dashboard/app.js"
      to: "crates/lmlang-server/src/handlers/locks.rs"
      via: "Lock operations propagate selected agent id through X-Agent-Id header"
      pattern: "X-Agent-Id|locks"
    - from: "crates/lmlang-server/static/dashboard/app.js"
      to: "crates/lmlang-server/src/handlers/mutations.rs"
      via: "Mutation dry-run and commit flows align with existing propose_edit API contract"
      pattern: "mutations|dry_run"
---

<objective>
Implement endpoint-first Operate workflows in the unified dashboard.

Purpose: Fulfill Phase 10 orchestration UX using existing backend APIs and no new run-lifecycle endpoints.
Output: Operate panels for agent/session visibility, run setup, and core action execution against current endpoints.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-unified-dashboard-shell-endpoint-first-operate-tab/10-RESEARCH.md
@.planning/phases/10-unified-dashboard-shell-endpoint-first-operate-tab/10-01-PLAN.md
@crates/lmlang-server/src/schema/agents.rs
@crates/lmlang-server/src/schema/locks.rs
@crates/lmlang-server/src/schema/mutations.rs
@crates/lmlang-server/src/schema/verify.rs
@crates/lmlang-server/src/schema/simulate.rs
@crates/lmlang-server/src/schema/compile.rs
@crates/lmlang-server/src/schema/history.rs
@crates/lmlang-server/src/handlers/locks.rs
@crates/lmlang-server/src/handlers/mutations.rs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build Operate API adapter and agent/session status model</name>
  <files>
    crates/lmlang-server/static/dashboard/app.js
    crates/lmlang-server/static/dashboard/index.html
    crates/lmlang-server/static/dashboard/styles.css
  </files>
  <action>
    Implement a client-side API layer for existing endpoints with:
    - JSON request helpers and error normalization
    - selected agent identity management
    - conditional X-Agent-Id header injection for lock/mutation workflows
    - derived agent/session state labels: idle, running, blocked, error

    Render an Operate panel that lists agents and presents status-oriented session cards.
  </action>
  <verify>
    Manual dashboard smoke test validates agent registration/listing and status transitions after actions.
  </verify>
  <done>
    Operate tab shows actionable agent/session state without introducing backend API changes.
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement endpoint-first run setup and action panels</name>
  <files>
    crates/lmlang-server/static/dashboard/index.html
    crates/lmlang-server/static/dashboard/app.js
    crates/lmlang-server/static/dashboard/styles.css
    crates/lmlang-server/tests/integration_test.rs
  </files>
  <action>
    Add run setup controls (program selector, workflow template selector, task prompt) and wire action sections to existing endpoints:
    - register/list/deregister agents
    - acquire/release/list locks
    - mutation dry-run and commit
    - verify (local/full), simulate, compile, and history fetch

    Show request/response payload snapshots in Operate output panels for debugging and operator trust.
    Add integration/static-contract tests that assert dashboard assets include required Operate endpoint hooks.
  </action>
  <verify>
    `cargo test --package lmlang-server --test integration_test` passes and dashboard manual flow can execute endpoint-first actions.
  </verify>
  <done>
    Operate tab can launch and monitor key orchestration primitives entirely through existing API contracts.
  </done>
</task>

</tasks>

<verification>
1. Operate tab displays registered agents and derived status labels
2. Run setup controls include program, workflow template, and task prompt inputs
3. Lock/mutation operations send X-Agent-Id when required
4. Mutations support both dry-run and commit from Operate UI
5. Verify/simulate/compile/history actions execute from Operate and render structured feedback
6. No new backend API routes are required for Phase 10 Operate behavior
</verification>

<success_criteria>
- UI-01 satisfied with visible, actionable agent/session state in Operate
- UI-02 satisfied with run setup and launch flow in Operate
- Operate behavior is endpoint-first and compatible with existing server contracts
</success_criteria>

<output>
After completion, create `.planning/phases/10-unified-dashboard-shell-endpoint-first-operate-tab/10-02-SUMMARY.md`
</output>
