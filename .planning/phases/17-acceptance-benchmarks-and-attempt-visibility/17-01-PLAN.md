---
phase: 17-acceptance-benchmarks-and-attempt-visibility
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - crates/lmlang-server/src/schema/autonomy_execution.rs
  - crates/lmlang-server/src/project_agent.rs
  - crates/lmlang-server/src/schema/agent_control.rs
  - crates/lmlang-server/src/schema/dashboard.rs
  - crates/lmlang-server/src/handlers/agent_control.rs
  - crates/lmlang-server/src/handlers/dashboard.rs
autonomous: true
requirements:
  - AUT-09

must_haves:
  truths:
    - "Operator-facing responses expose structured per-attempt history (not transcript parsing) including action rows and terminal outcomes"
    - "Existing latest-attempt execution summary remains backward-compatible for current clients"
    - "Attempt history projection is deterministic and bounded enough for dashboard rendering"
    - "Timeline schema carries enough detail for benchmark and troubleshooting assertions (attempt index, action kind/status, diagnostics, stop reason)"
  artifacts:
    - path: "crates/lmlang-server/src/schema/autonomy_execution.rs"
      provides: "Stable attempt/timeline projection models or helpers used by API-level visibility views"
      contains: "AutonomyExecutionAttemptSummary"
    - path: "crates/lmlang-server/src/schema/agent_control.rs"
      provides: "Agent endpoint response fields for full execution history/timeline rows"
      contains: "Execution"
    - path: "crates/lmlang-server/src/schema/dashboard.rs"
      provides: "Dashboard chat response fields for attempt timeline visibility"
      contains: "execution"
    - path: "crates/lmlang-server/src/handlers/agent_control.rs"
      provides: "Projection wiring from persisted session attempts into response timeline fields"
      contains: "execution_attempts"
    - path: "crates/lmlang-server/src/handlers/dashboard.rs"
      provides: "Dashboard orchestration responses include timeline-ready attempt history data"
      contains: "DashboardAiChatResponse"
  key_links:
    - from: "crates/lmlang-server/src/handlers/agent_control.rs"
      to: "crates/lmlang-server/src/project_agent.rs"
      via: "Agent-control projections derive timeline rows from persisted `execution_attempts` state"
      pattern: "execution_attempts|Execution"
    - from: "crates/lmlang-server/src/handlers/dashboard.rs"
      to: "crates/lmlang-server/src/schema/dashboard.rs"
      via: "Dashboard chat handler serializes attempt-history visibility fields defined in schema"
      pattern: "execution|timeline|attempt"
    - from: "crates/lmlang-server/src/schema/agent_control.rs"
      to: "crates/lmlang-server/src/schema/autonomy_execution.rs"
      via: "Execution timeline views map typed autonomy execution attempt/action evidence"
      pattern: "AutonomyExecutionAttemptSummary|AutonomyActionExecutionResult"
---

<objective>
Implement the AUT-09 visibility contract foundation.

Purpose: Make autonomous attempt history first-class and structured across operator-facing APIs.
Output: Backward-compatible execution projection with explicit per-attempt timeline rows and terminal outcome detail.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@.planning/STATE.md
@.planning/phases/17-acceptance-benchmarks-and-attempt-visibility/17-RESEARCH.md
@.planning/phases/16-verify-compile-repair-loop/16-VERIFICATION.md
@crates/lmlang-server/src/project_agent.rs
@crates/lmlang-server/src/schema/autonomy_execution.rs
@crates/lmlang-server/src/schema/agent_control.rs
@crates/lmlang-server/src/schema/dashboard.rs
@crates/lmlang-server/src/handlers/agent_control.rs
@crates/lmlang-server/src/handlers/dashboard.rs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add structured attempt-history projection models and mapping helpers</name>
  <files>
    crates/lmlang-server/src/schema/autonomy_execution.rs
    crates/lmlang-server/src/schema/agent_control.rs
    crates/lmlang-server/src/schema/dashboard.rs
    crates/lmlang-server/src/handlers/agent_control.rs
  </files>
  <action>
    Extend response schema/projection so operator-facing payloads can include ordered attempt history:
    - attempt index/max-attempts/planner status
    - per-action kind/status/summary/error/diagnostics
    - per-attempt and terminal stop reason details

    Keep existing `execution` latest-summary fields intact, and add timeline/history fields as optional/compatible so existing clients remain functional.
  </action>
  <verify>
    Unit and handler-level assertions confirm timeline rows are projected from `execution_attempts` deterministically and older payload readers remain compatible.
  </verify>
  <done>
    APIs can return structured autonomous attempt history without relying on free-form transcript strings.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire timeline visibility through project-agent and dashboard handlers</name>
  <files>
    crates/lmlang-server/src/project_agent.rs
    crates/lmlang-server/src/handlers/agent_control.rs
    crates/lmlang-server/src/handlers/dashboard.rs
  </files>
  <action>
    Ensure persisted attempt evidence is consistently available to both:
    - project-agent detail/chat responses, and
    - dashboard AI chat orchestration responses.

    Preserve run-state behavior from prior phases while exposing enough timeline metadata for downstream benchmark and UI layers.
  </action>
  <verify>
    Integration checks confirm timeline data is present after autonomous run completion and includes attempt/action rows plus final stop reason.
  </verify>
  <done>
    AUT-09 backend contract foundation is complete and ready for benchmark assertions/UI consumption.
  </done>
</task>

</tasks>

<verification>
1. Response schemas include optional timeline/history fields for autonomous attempt records
2. Timeline projection includes attempt metadata, per-action output status, diagnostics, and terminal outcome
3. Existing `execution` latest-summary fields remain backward-compatible
4. Agent and dashboard handlers both expose the same core timeline contract
5. Timeline data is derived from persisted `execution_attempts` (not recomputed from transcript text)
</verification>

<success_criteria>
- AUT-09 foundation complete: autonomous steps and outcomes are queryable as structured timeline data
- Phase 17 benchmark and dashboard plans can consume the same timeline contract without schema churn
</success_criteria>

<output>
After completion, create `.planning/phases/17-acceptance-benchmarks-and-attempt-visibility/17-01-SUMMARY.md`
</output>
