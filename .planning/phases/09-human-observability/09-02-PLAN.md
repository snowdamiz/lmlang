---
phase: 09-human-observability
plan: 02
type: execute
wave: 2
depends_on:
  - "09-01"
files_modified:
  - crates/lmlang-server/src/handlers/observability.rs
  - crates/lmlang-server/src/handlers/mod.rs
  - crates/lmlang-server/src/router.rs
  - crates/lmlang-server/src/main.rs
  - crates/lmlang-server/Cargo.toml
  - crates/lmlang-server/static/observability/index.html
  - crates/lmlang-server/static/observability/app.js
  - crates/lmlang-server/static/observability/styles.css
  - crates/lmlang-server/tests/integration_test.rs
autonomous: true
requirements:
  - VIZ-01
  - VIZ-02

must_haves:
  truths:
    - "A human can open a browser UI and explore the program as an interactive DAG"
    - "Default graph presentation is clean/minimal while preserving on-demand detail via right-side panel"
    - "Semantic and compute layers are shown in separated same-canvas regions with distinct encoding"
    - "Cross-layer edges are visibly distinct and can be filtered"
    - "Layer visibility toggles and preset filters work for semantic-only, compute-only, and interop views"
  artifacts:
    - path: "crates/lmlang-server/static/observability/index.html"
      provides: "Observability UI shell with graph canvas, query bar, filter controls, and details panel layout"
      min_lines: 90
    - path: "crates/lmlang-server/static/observability/app.js"
      provides: "Client graph rendering + interaction logic (selection, toggles, panel sync)"
      min_lines: 260
    - path: "crates/lmlang-server/static/observability/styles.css"
      provides: "Visual language for layer differentiation and cross-layer edge styling"
      min_lines: 170
    - path: "crates/lmlang-server/src/router.rs"
      provides: "Routes for observability data endpoints and static UI delivery"
      contains: "observability"
  key_links:
    - from: "crates/lmlang-server/src/handlers/observability.rs"
      to: "crates/lmlang-server/src/service.rs"
      via: "HTTP handlers delegate graph data retrieval to ProgramService"
      pattern: "graph|layer|filter"
    - from: "crates/lmlang-server/static/observability/app.js"
      to: "crates/lmlang-server/src/schema/observability.rs"
      via: "Frontend consumes stable observability payload shape"
      pattern: "node|edge|layer"
    - from: "crates/lmlang-server/src/router.rs"
      to: "crates/lmlang-server/static/observability/index.html"
      via: "Router exposes web entrypoint for human observability"
      pattern: "observability"
---

<objective>
Ship the interactive observability UI and route integration for DAG exploration with layer controls.

Purpose: Deliver the human-facing visualization surface required for VIZ-01 and VIZ-02.
Output: Browser-accessible graph explorer with minimal default display, layer differentiation, and details-on-click panel.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-human-observability/09-CONTEXT.md
@.planning/phases/09-human-observability/09-RESEARCH.md
@.planning/phases/09-human-observability/09-01-PLAN.md
@crates/lmlang-server/src/router.rs
@crates/lmlang-server/src/main.rs
@crates/lmlang-server/src/handlers/queries.rs
@crates/lmlang-server/src/service.rs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add observability routes and static UI hosting</name>
  <files>
    crates/lmlang-server/src/handlers/observability.rs
    crates/lmlang-server/src/handlers/mod.rs
    crates/lmlang-server/src/router.rs
    crates/lmlang-server/src/main.rs
    crates/lmlang-server/Cargo.toml
    crates/lmlang-server/tests/integration_test.rs
  </files>
  <action>
    Add dedicated observability handlers/routes for graph payload retrieval and web UI entrypoint.
    Configure static asset serving from the server binary without introducing a separate frontend build system.
    Add route-level integration tests for UI and data endpoints.
  </action>
  <verify>
    `cargo test --package lmlang-server --test integration_test` includes route checks for observability endpoints/static files.
  </verify>
  <done>
    Observability routes are reachable and serve both JSON graph data and browser UI assets.
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement clean-by-default interactive DAG with layer controls and details panel</name>
  <files>
    crates/lmlang-server/static/observability/index.html
    crates/lmlang-server/static/observability/app.js
    crates/lmlang-server/static/observability/styles.css
  </files>
  <action>
    Build the human observability UI with:
    - interactive DAG rendering (pan/zoom/select)
    - minimal default labels and progressive detail reveal
    - right-side details panel opened by node click
    - separated visual regions for semantic vs compute layers
    - visually distinct cross-layer edges (for example dashed) and layer filter toggles
    - presets for semantic-only, compute-only, and interop views

    Ensure desktop and mobile viewport behavior remains usable.
  </action>
  <verify>
    Manual smoke check in browser plus route tests; static UI loads and interacts with live graph payload.
  </verify>
  <done>
    Human users can visually explore the graph with clear layer differentiation and on-demand details.
  </done>
</task>

</tasks>

<verification>
1. Observability web entrypoint loads successfully from server routes
2. Graph canvas renders nodes/edges/function boundaries from backend payload
3. Layer differentiation is visible and toggles/presets work
4. Cross-layer edges are visually distinct and filterable
5. Clicking nodes opens synchronized right-side detail panel
</verification>

<success_criteria>
- Interactive DAG exploration is available to humans via browser
- Layer separation and cross-layer cues are clear by default
- UI reflects context preference: clean graph first, rich details on demand
</success_criteria>

<output>
After completion, create `.planning/phases/09-human-observability/09-02-SUMMARY.md`
</output>
